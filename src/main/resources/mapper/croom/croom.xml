<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--24.02.18 생성 -->
<!-- 매퍼파일 -->
<mapper namespace="com.ict.teamProject.challenge_room.service.impl.CRMapper">
   <!--<resultMap type="CRDto" id="CRResult">
		<result property="mno" column="MESSAGE_NO"/>
		<result property="rno" column="ROOM_TYPE"/>
		<result property="id" column="ID"/>
		<result property="ruser" column="RECEIVE_USER"/>
		<result property="tno" column="TYPE_NO"/>
		<result property="content" column="MESSAGE_CONTENT"/>
		<result property="notice" column="MESSAGE_NOTICE"/>
		<result property="sendDate" column="MESSAGE_SENDDATE"/>		
	</resultMap>-->
	
	<!-- 시퀀스 값 생성 및 저장 -->
	<select id="getSeqValue" resultType="int">
	  SELECT SEQ_CHALLENGEROOM.NEXTVAL FROM dual
	</select>
	
	<!-- 방생성 -->
	<insert id="save" parameterType="Map">
		INSERT INTO CHALLENGE_ROOM VALUES(SEQ_CHALLENGEROOM.NEXTVAL,1,#{challCapacity},#{implementation},#{gLimit},#{ageMin},
		#{ageMax},#{pFee},#{cYN},SYSDATE,#{cStartDate},#{cEndDate},#{challContent})
	</insert>
	
	<!-- 방생성 -->
	<insert id="insertP" parameterType="CP">
		INSERT INTO CHALLENGE_PARTICIPANTS VALUES(SEQ_CHALLP.NEXTVAL,#{challNo},#{id},'Y')
	</insert>
	
 	<!-- 방 번호 가져오기 -->
	 <select id="getMyRoom" parameterType="String" resultType="Integer">
	 	SELECT Chall_NO FROM CHALLENGE_PARTICIPANTS WHERE ID = #{id}
	 </select>
	 
	<!-- 해당 방 삭제 -->
	<delete id="delete" parameterType="int">
	  DELETE FROM CHALLENGE_ROOM WHERE Chall_NO = #{challNo}
	</delete>
	
	<!-- 해당 방 삭제 -->
	<delete id="deletep" parameterType="String">
	  DELETE FROM CHALLENGE_PARTICIPANTS WHERE ID = #{id}
	</delete>
	 
	<!-- 
	<select id="findChatingPerson" parameterType="String" resultType="CRDto">
	    SELECT * FROM (
	        SELECT *, ROW_NUMBER() OVER (PARTITION BY RECEIVE_USER ORDER BY ID) as rn 
	        FROM CHATMESSAGE WHERE ID = #{id}
	    ) t 
	    WHERE rn = 1
	</select>-->

 	<!-- 모든 메세지 가져오기 
	 <select id="allChat" parameterType="String" resultMap="CRResult">
	 	SELECT * FROM CHATMESSAGE WHERE ID = #{id} or RECEIVE_USER = #{id} ORDER BY MESSAGE_SENDDATE ASC
	 </select>-->

	
</mapper>