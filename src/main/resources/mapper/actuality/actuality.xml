<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ict.teamProject.actuality.ActualityMapper">	
	
	<insert id="saveActuality" parameterType="Map">
		Insert INTO actuality_eating(id, ae_diettype, ae_foodname) Values(#{id}, #{ae_diettype}, #{ae_foodname})
	</insert>
	
	<select id="dailyActuality" resultType="ActualityEatingDto">
		SELECT ae.*, fl.calory,fl.carbohydrate,fl.protein,fl.fat,fl.sodium,fl.cholesterol FROM
			(SELECT * FROM actuality_eating WHERE id = #{id} And TO_CHAR(ae_date, 'YYYY-MM-DD') = TO_CHAR(SYSDATE, 'YYYY-MM-DD')) ae
			JOIN foodlist fl ON ae.ae_foodname = fl.foodname
			ORDER BY 
			    CASE 
			        WHEN ae_diettype = '아침' THEN 1
			        WHEN ae_diettype = '점심' THEN 2
			        ELSE 3
			    END
		        
	</select>
	
	<select id="checkdailydiet" resultType="int">
		SELECT count(*) FROM actuality_eating WHERE id = #{id} And TO_CHAR(ae_date, 'YYYY-MM-DD') = TO_CHAR(SYSDATE, 'YYYY-MM-DD') AND ae_dietType = #{ae_diettype}
	</select>	
	
	<update id="updateActuality" parameterType="Map">
		UPDATE actuality_eating SET ae_foodname = #{ae_foodname} WHERE id = #{id} and ae_diettype = #{ae_diettype} And TO_CHAR(ae_date, 'YYYY-MM-DD') = TO_CHAR(SYSDATE, 'YYYY-MM-DD')
	</update>
</mapper>