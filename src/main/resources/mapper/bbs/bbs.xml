<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 매퍼파일 -->
<mapper namespace="com.ict.teamProject.bbs.service.impl.BBSMapper">

	<resultMap type="onememoDto" id="onememoResult">
		<result property="no" column="no"/>
		<result property="title" column="title"/>
		<result property="content" column="content"/>
		<result property="postDate" column="postDate"/>
		<result property="id" column="id"/>
		<result property="name" column="name"/>
		<!-- 조인 쿼리시 반드시 commentCounts로 별칭하자 -->
		<result property="commentCounts" column="commentCounts"/>
		<!-- 
		1:N관계 매핑용(collection요소 사용)
		column: 조인 조건의 컬럼명 (ON onememo.no = linecomment.no)
		select: select태그의 id 속성값(쿼리문은 조인문)
		javaType : Onememo테이블의 자식 레코드를 담는 컬렉션 타입 즉 (List<LineCommentDTO>)
		ofType : 자식의 DTO타입
		property: 댓글 목록을 담을 OnememoDTO속성명
		
		
		아래 collection요소 사용시 
		현재 매퍼파일에서 메모글 하나 가져올때 반드시 resultMap="memoDtoResult"을 사용하지
		 -->
		<collection property="comments" column="no" select="com.ictedu.springapp.onememo.service.impl.CommentMapper.findAllByNo" javaType="list" ofType="commentDto"/>
	</resultMap>
	
	<insert id="save" parameterType="Map">
		INSERT INTO onememo VALUES(SEQ_ONEMEMO.NEXTVAL,#{title},#{content},SYSDATE,#{id})	
	</insert>
	<select id="findByKey" parameterType="Map" resultMap="onememoResult">
		<!-- 글 번호에 따른 댓글 수는 제외하고 조회(상세보기 화면이니까:해당 글번호의 모든 댓글 뿌리니까) -->
		SELECT o.*,name
		FROM onememo o JOIN member m ON m.id=o.id
		WHERE no=#{no}
	</select>
	<update id="updateByKey" parameterType="onememoDto">
		UPDATE onememo SET title=#{title},content=#{content} WHERE no=#{no}	
	</update>
	<delete id="deleteByKey" parameterType="onememoDto">
		DELETE onememo WHERE no=#{no}
	</delete>
	<!-- 스프링 씨큐리티 회원 입력용(REST API서비스) -->
	<insert id="saveUser" parameterType="Map">
		INSERT INTO member VALUES(#{id},#{pwd},#{name},DEFAULT,DEFAULT)
	</insert>
</mapper>